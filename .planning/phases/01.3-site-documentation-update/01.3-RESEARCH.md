# Phase 1.3: Site Documentation Update - Research

**Researched:** 2026-01-21
**Domain:** Hugo documentation site with i18n (Hextra theme)
**Confidence:** HIGH

## Summary

The cc-relay project uses a Hugo-based documentation site with the Hextra theme, supporting 6 languages (English, German, Spanish, Japanese, Chinese, Korean). The site documentation is located in `docs-site/` and is separate from the comprehensive technical documentation in `docs/cache.md`.

The site caching documentation (`docs-site/content/*/docs/caching.md`) is approximately 337 lines per language, while the comprehensive `docs/cache.md` is 1033 lines. This represents a significant documentation gap - the site docs are missing critical HA clustering content that was implemented in Phase 1.1 and documented in Phase 1.2.

**Primary recommendation:** Update English caching.md first with HA clustering details from docs/cache.md, then translate to all 5 other languages. Also update configuration.md to include cache configuration section.

## Site Structure Analysis

### Documentation Framework

| Aspect | Details | Confidence |
|--------|---------|------------|
| Framework | Hugo static site generator | HIGH (verified: hugo.yaml) |
| Theme | Hextra (github.com/imfing/hextra) | HIGH (verified: go.mod) |
| i18n approach | Separate content directories per language | HIGH (verified: content/*/) |
| Build | Hugo modules + go.mod | HIGH (verified) |

### Languages Supported

| Language Code | Language Name | Weight (sort order) |
|---------------|---------------|---------------------|
| `en` | English | 1 (default) |
| `de` | Deutsch | 2 |
| `es` | Espanol | 3 |
| `ja` | Japanese | 4 |
| `zh-cn` | Chinese (Simplified) | 5 |
| `ko` | Korean | 6 |

**Translation files:** Located in `docs-site/i18n/*.yaml` for UI strings

### Content Structure Per Language

```
docs-site/content/{lang}/
├── _index.md          # Homepage (landing page with features, architecture)
├── about.md           # About page
└── docs/
    ├── _index.md      # Docs landing page
    ├── getting-started.md
    ├── configuration.md
    ├── architecture.md
    ├── api.md
    └── caching.md
```

## Documentation Gap Analysis

### Missing Content from Site Caching Docs

The comprehensive `docs/cache.md` (1033 lines) contains sections NOT present in site docs (337 lines):

| Missing Section | Impact | Priority |
|-----------------|--------|----------|
| Cache Key Conventions | User needs key design guidance | MEDIUM |
| Complete Configuration Reference (RistrettoConfig, OlricConfig) | Site docs have basic examples only | HIGH |
| Cache Busting Strategies | TTL, manual invalidation, cluster events | MEDIUM |
| **HA Clustering Guide** | Prerequisites, port requirements, environment settings, multi-node examples | **CRITICAL** |
| Replication and Quorum Explained | Users need to understand HA configuration | HIGH |
| Extending with New Backends | Redis skeleton, implementation checklist | MEDIUM |
| API Reference (detailed) | Factory function, default configs | LOW |

### Critical HA Clustering Content Missing

The site docs mention HA mode but lack:

1. **Port Requirements** - Memberlist uses `bind_addr + 2` (e.g., 3320 + 2 = 3322)
2. **Environment Settings Table** - local/lan/wan with timing parameters
3. **Two-Node Cluster Example** - Production-ready YAML
4. **Three-Node Docker Compose Example** - Container deployment guide
5. **Replication and Quorum** - replica_count, read_quorum, write_quorum explained
6. **Troubleshooting HA Issues** - Nodes cannot join, quorum errors, data not replicated

### Site Docs Also Need Configuration Section Update

The `configuration.md` page does NOT include cache configuration. It covers:
- Server configuration
- Provider configuration
- Logging configuration

Missing: Cache configuration section with all three modes

## Translation Workflow

### Observed Pattern

Each language has identical structure with translated content:
- Markdown frontmatter preserved (title translated, weight identical)
- Code blocks kept in English (Go, YAML, bash)
- Technical terms often kept in English (Ristretto, Olric, TTL)
- Tables translated

### Translation Quality Assessment

Reviewed caching.md across all languages:

| Language | Quality | Notes |
|----------|---------|-------|
| English | Baseline | Source of truth |
| German | Good | Uses umlauts correctly, technical accuracy |
| Spanish | Good | Consistent terminology |
| Japanese | Good | Proper technical term handling |
| Chinese | Good | Simplified characters |
| Korean | Good | Consistent with other translations |

### Translation Approach

1. Update English first as source of truth
2. Generate translations for identical content structure
3. Keep code blocks, YAML examples, and technical identifiers in English
4. Translate prose, headings, and table labels

## Files Requiring Updates

### Primary Content Files

| File | Update Type | Priority |
|------|-------------|----------|
| `docs-site/content/en/docs/caching.md` | Add HA clustering guide, config reference | CRITICAL |
| `docs-site/content/en/docs/configuration.md` | Add cache configuration section | HIGH |
| `docs-site/content/de/docs/caching.md` | Translation of EN updates | HIGH |
| `docs-site/content/es/docs/caching.md` | Translation of EN updates | HIGH |
| `docs-site/content/ja/docs/caching.md` | Translation of EN updates | HIGH |
| `docs-site/content/zh-cn/docs/caching.md` | Translation of EN updates | HIGH |
| `docs-site/content/ko/docs/caching.md` | Translation of EN updates | HIGH |
| `docs-site/content/de/docs/configuration.md` | Translation of cache section | MEDIUM |
| `docs-site/content/es/docs/configuration.md` | Translation of cache section | MEDIUM |
| `docs-site/content/ja/docs/configuration.md` | Translation of cache section | MEDIUM |
| `docs-site/content/zh-cn/docs/configuration.md` | Translation of cache section | MEDIUM |
| `docs-site/content/ko/docs/configuration.md` | Translation of cache section | MEDIUM |

### Homepage Updates (Optional)

The homepage (`_index.md`) could mention caching as a feature, but this is optional since caching is an infrastructure feature not a user-facing feature.

## Technical Approach

### Hugo/Hextra Patterns

**Content frontmatter:**
```yaml
---
title: Caching
weight: 6
---
```

**Mermaid diagrams:** Supported via code blocks with `mermaid` language tag

**Feature grid shortcodes:** Available but not used in docs pages (only homepage)

**Internal links:** Use relative paths with language prefix:
- English: `/docs/configuration/`
- German: `/de/docs/configuration/`

### Content Considerations

1. **Keep code blocks in English** - YAML, Go, bash commands are universal
2. **Mermaid diagrams** - Already present in caching.md, keep as-is
3. **Tables** - Translate headers and content, keep technical values
4. **URLs/links** - Update to include language prefix

## Risks and Mitigations

### Risk 1: Translation Quality

**Risk:** Machine translation may produce awkward phrasing
**Mitigation:** Follow existing translation patterns in codebase; keep technical terms in English; focus on accuracy over eloquence

### Risk 2: Documentation Drift

**Risk:** Site docs may diverge from `docs/cache.md`
**Mitigation:** Site docs should be a curated subset, not a 1:1 copy; link to comprehensive docs where appropriate

### Risk 3: Build Failures

**Risk:** Hugo build may fail after updates
**Mitigation:** Test with `hugo server` in docs-site directory before committing

### Risk 4: Missed Files

**Risk:** May miss updating some language files
**Mitigation:** Use glob patterns to identify all files; systematic checklist approach

## Standard Patterns

### Adding New Section to Existing Doc

```markdown
## Section Title

Content paragraph.

### Subsection

More content.

| Column 1 | Column 2 |
|----------|----------|
| Value | Description |

```yaml
# YAML example
key: value
```
```

### Linking Between Docs

Within same language:
```markdown
See [Configuration](/docs/configuration/) for details.
```

Cross-reference (should be language-aware):
```markdown
- [Configuration reference](/en/docs/configuration/)  # In English
- [Konfigurationsreferenz](/de/docs/configuration/)   # In German
```

## Content to Add

### HA Clustering Guide (from docs/cache.md)

Add these sections to site caching.md:

1. **HA Clustering Guide** section
   - Prerequisites (network, ports, consistent config)
   - Port Requirements table (Olric port, memberlist port = bind_addr + 2)
   - Environment Settings table (local, lan, wan with timings)
   - Two-Node Cluster Example (complete YAML for both nodes)
   - Three-Node Docker Compose Example
   - Replication and Quorum Explained (tables with recommendations)

2. **Enhanced Troubleshooting** section
   - Nodes Cannot Join Cluster (wrong peer port, firewall, DNS)
   - Quorum Errors
   - Data Not Replicated

### Cache Configuration for configuration.md

Add cache section with:
- Mode selection (single, ha, disabled)
- Ristretto config options
- Olric config options (embedded and client mode)
- Example configurations

## Open Questions

None - all research questions resolved.

## Sources

### Primary (HIGH confidence)
- `/home/omarluq/sandbox/go/cc-relay/docs-site/hugo.yaml` - Hugo configuration
- `/home/omarluq/sandbox/go/cc-relay/docs/cache.md` - Comprehensive cache documentation
- `/home/omarluq/sandbox/go/cc-relay/docs-site/content/en/docs/caching.md` - Current site docs

### Secondary (MEDIUM confidence)
- Hextra theme documentation (verified via usage patterns in codebase)

### Tertiary (LOW confidence)
- None

## Metadata

**Confidence breakdown:**
- Site structure: HIGH - Direct file inspection
- Languages supported: HIGH - Verified hugo.yaml and content directories
- Gap analysis: HIGH - Compared actual file contents
- Translation workflow: MEDIUM - Inferred from existing translations

**Research date:** 2026-01-21
**Valid until:** 2026-02-21 (stable - site structure unlikely to change)
