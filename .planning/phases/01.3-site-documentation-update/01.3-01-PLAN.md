---
phase: 01.3-site-documentation-update
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs-site/content/en/docs/caching.md
autonomous: true

must_haves:
  truths:
    - "Site caching.md includes HA clustering guide with port requirements"
    - "Site caching.md includes environment settings table"
    - "Site caching.md includes two-node and three-node cluster examples"
    - "Site caching.md includes replication and quorum explanation"
    - "Site caching.md includes HA troubleshooting section"
  artifacts:
    - path: "docs-site/content/en/docs/caching.md"
      provides: "English caching documentation with HA clustering guide"
      contains: "## HA Clustering Guide"
  key_links:
    - from: "docs-site/content/en/docs/caching.md"
      to: "docs/cache.md"
      via: "content adaptation"
      pattern: "HA Clustering Guide"
---

<objective>
Update English site caching documentation with HA clustering content from docs/cache.md

Purpose: The site documentation is missing critical HA clustering content that was implemented in Phase 1.1 and documented in Phase 1.2. Site docs have 337 lines while comprehensive docs/cache.md has 1033 lines - this gap must be closed for users accessing the documentation site.

Output: Updated docs-site/content/en/docs/caching.md with HA Clustering Guide section
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01.3-site-documentation-update/01.3-RESEARCH.md
@docs/cache.md
@docs-site/content/en/docs/caching.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add HA Clustering Guide section to English caching.md</name>
  <files>docs-site/content/en/docs/caching.md</files>
  <action>
Add a new "## HA Clustering Guide" section after the "### Embedded Mode" subsection of "### HA Mode (Olric)". Include the following content adapted from docs/cache.md:

1. **Prerequisites** subsection:
   - Network connectivity requirements
   - Port accessibility requirements
   - Consistent configuration requirements

2. **Port Requirements** subsection with table:
   | Port | Purpose | Default |
   |------|---------|---------|
   | `bind_addr` port | Olric client connections | 3320 |
   | `bind_addr` port + 2 | Memberlist gossip protocol | 3322 |

   Include the bash firewall commands example.

3. **Environment Settings** subsection with table:
   | Setting | Gossip Interval | Probe Interval | Probe Timeout | Use When |
   |---------|-----------------|----------------|---------------|----------|
   | `local` | 100ms | 100ms | 200ms | Same host, development |
   | `lan` | 200ms | 1s | 500ms | Same datacenter |
   | `wan` | 500ms | 3s | 2s | Cross-datacenter |

   Note that all nodes must use the same environment setting.

4. **Two-Node Cluster Example** subsection:
   - Complete YAML for Node 1 (cc-relay-1)
   - Complete YAML for Node 2 (cc-relay-2)
   - Highlight that peers use memberlist port (bind_addr + 2)

5. **Three-Node Docker Compose Example** subsection:
   - Full docker-compose.yaml with three services
   - Port mappings for HTTP, Olric client, and memberlist
   - Reference to per-node config files

6. **Replication and Quorum Explained** subsection:
   - replica_count table explaining 1, 2, 3 copies
   - read_quorum/write_quorum consistency vs availability table
   - Recommendations table for different cluster sizes

Keep code blocks in YAML/bash (no translation needed). Adapt the content for the site documentation style (slightly more concise than comprehensive docs/cache.md).
  </action>
  <verify>
Run `hugo --source docs-site` to verify the documentation builds without errors.
Verify the new section appears between existing sections by checking line count increased significantly.
  </verify>
  <done>
English caching.md contains HA Clustering Guide section with all 6 subsections (Prerequisites, Port Requirements, Environment Settings, Two-Node Example, Three-Node Docker Compose, Replication and Quorum).
  </done>
</task>

<task type="auto">
  <name>Task 2: Add enhanced HA troubleshooting to English caching.md</name>
  <files>docs-site/content/en/docs/caching.md</files>
  <action>
Enhance the existing Troubleshooting section by adding HA-specific issues from docs/cache.md:

1. Add "### Nodes Cannot Join Cluster" subsection:
   - Symptom: Nodes start but don't discover each other
   - Causes: Wrong peer port, firewall blocking, DNS resolution, environment mismatch
   - Include code examples for checking connectivity with nc and getent

2. Add "### Quorum Errors" subsection:
   - Symptom: "not enough members" or operations fail despite nodes being up
   - Solution: Ensure member_count_quorum <= actual running nodes
   - Example configurations for 2-node and 3-node clusters

3. Add "### Data Not Replicated" subsection:
   - Symptom: Data disappears when a node goes down
   - Solution: replica_count > 1 and enough nodes
   - Example configuration

These should be added under the existing "## Troubleshooting" section, after the existing "### Olric cluster connectivity issues" subsection.
  </action>
  <verify>
Check that the troubleshooting section now has HA-specific subsections by grepping for "Nodes Cannot Join Cluster".
  </verify>
  <done>
English caching.md troubleshooting section includes HA-specific issues: Nodes Cannot Join Cluster, Quorum Errors, Data Not Replicated.
  </done>
</task>

</tasks>

<verification>
1. Hugo builds successfully: `hugo --source docs-site`
2. English caching.md has HA Clustering Guide section
3. English caching.md has enhanced HA troubleshooting
4. Line count significantly increased from original ~337 lines
</verification>

<success_criteria>
- docs-site/content/en/docs/caching.md contains complete HA Clustering Guide
- HA troubleshooting content added
- Documentation site builds without errors
- Content properly adapted from docs/cache.md (site-appropriate, not verbatim copy)
</success_criteria>

<output>
After completion, create `.planning/phases/01.3-site-documentation-update/01.3-01-SUMMARY.md`
</output>
