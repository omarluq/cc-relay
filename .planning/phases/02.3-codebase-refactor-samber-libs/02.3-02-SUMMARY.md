---
phase: 02.3-codebase-refactor-samber-libs
plan: 02
subsystem: dependencies
tags: [samber, lo, do, mo, ro, gopter, functional, di, monads, reactive]
requires:
  - 02.3-01 (codebase architecture mapping)
provides:
  - samber library dependencies in go.mod
  - skill documentation for consistent library usage
affects:
  - 02.3-03 (lo refactoring)
  - 02.3-04 (mo refactoring)
  - 02.3-05 (do refactoring)
  - All future development using samber patterns
tech-stack:
  added:
    - github.com/samber/lo@v1.52.0
    - github.com/samber/do/v2@v2.0.0
    - github.com/samber/mo@v1.16.0
    - github.com/samber/ro@v0.2.0
    - github.com/leanovate/gopter@v0.2.11
  patterns:
    - Functional collection processing (lo)
    - Monadic error handling (mo)
    - Dependency injection (do)
    - Reactive streams (ro)
key-files:
  created:
    - internal/pkg/functional/functional.go
    - .claude/skills/samber-lo.md
    - .claude/skills/samber-mo.md
    - .claude/skills/samber-do.md
    - .claude/skills/samber-ro.md
  modified:
    - go.mod
    - go.sum
decisions:
  - id: "02.3-02-D1"
    decision: "Created internal/pkg/functional package to anchor samber imports"
    rationale: "go mod tidy removes unused dependencies; functional.go uses all libraries to keep them in go.mod"
  - id: "02.3-02-D2"
    decision: "gopter added for property-based testing"
    rationale: "RESEARCH.md recommends gopter for complex logic validation (rate limiters, key selectors)"
  - id: "02.3-02-D3"
    decision: "samber/ro v0.2.0 included with cautious usage guidance"
    rationale: "Pre-1.0 stability documented in skill file; use for SSE streaming and event processing only"
metrics:
  duration: "8 min"
  completed: "2026-01-22"
---

# Phase 2.3 Plan 02: Install Samber Libraries and Create Skills Summary

**One-liner:** Installed samber/lo, do, mo, ro + gopter with 1857 lines of skill documentation for consistent adoption patterns.

## What Was Built

### Dependencies Added (go.mod)

| Library | Version | Purpose |
|---------|---------|---------|
| samber/lo | v1.52.0 | Functional collection utilities (Filter, Map, Reduce, GroupBy) |
| samber/do/v2 | v2.0.0 | Type-safe dependency injection with generics |
| samber/mo | v1.16.0 | Monads (Option, Result) for error handling |
| samber/ro | v0.2.0 | Reactive streams (pre-1.0, cautious use) |
| leanovate/gopter | v0.2.11 | Property-based testing |

### Skill Documentation Created

| File | Lines | Coverage |
|------|-------|----------|
| samber-lo.md | 371 | Collection processing, parallel variants, performance tips |
| samber-mo.md | 525 | Result/Option patterns, auth chains, config defaults |
| samber-do.md | 562 | DI patterns, serve.go wiring, request scopes, testing |
| samber-ro.md | 399 | SSE streaming, event logging, health checks |
| **Total** | **1857** | |

### Anchor Package

Created `internal/pkg/functional/functional.go` to:
- Keep samber libraries as direct dependencies (prevents go mod tidy removal)
- Provide version tracking
- Verify imports work with `VerifyImports()` function

## Commits

| Hash | Type | Description |
|------|------|-------------|
| 339113f | chore | Install samber libraries and gopter |
| d23a8e9 | docs | Create samber/lo and samber/mo skill documentation |
| 038e986 | docs | Create samber/do and samber/ro skill documentation |

## Key Patterns Documented

### samber/lo Patterns
- Filter/Map/Reduce for collection processing
- FilterMap for single-pass filter+transform
- GroupBy for organizing data by key
- lop (parallel) for large datasets (>1000 items)
- Performance tips: avoid chaining, benchmark hot paths

### samber/mo Patterns
- Result[T] for monadic error handling chains
- Option[T] for nullable config fields with defaults
- TupleToResult for converting (T, error) functions
- Pattern matching with Match for handling both cases
- Converting between styles at API boundaries

### samber/do Patterns
- Service provider functions: `func(do.Injector) (T, error)`
- Singleton vs transient lifecycles
- Request-scoped services via `do.NewScope`
- Named services for multi-provider scenarios
- Shutdown hooks implementing do.Shutdowner

### samber/ro Patterns
- Observable creation from channels and slices
- Operators: Map, Filter, Pipe, Catch
- SSE streaming pipeline example
- v0.2.0 stability warning and usage guidance
- When to use vs channels, lo, goroutines

## Deviations from Plan

None - plan executed exactly as written.

## Verification Results

- [x] `go mod tidy` succeeds
- [x] `go build ./...` succeeds
- [x] All four skill files exist in .claude/skills/
- [x] go.mod contains all samber libraries
- [x] go.mod contains stretchr/testify
- [x] All existing tests pass

## Next Phase Readiness

Ready for 02.3-03 (Refactor with samber/lo):
- lo library installed and importable
- Skill documentation provides patterns for Filter, Map, Reduce, GroupBy
- cc-relay specific examples ready (filter active keys, map providers, etc.)
- Performance guidance documented (FilterMap, parallel variants)
