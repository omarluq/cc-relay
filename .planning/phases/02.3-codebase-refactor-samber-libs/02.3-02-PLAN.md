---
phase: 02.3-codebase-refactor-samber-libs
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - go.mod
  - go.sum
  - .claude/skills/samber-lo.md
  - .claude/skills/samber-mo.md
  - .claude/skills/samber-do.md
  - .claude/skills/samber-ro.md
autonomous: true

must_haves:
  truths:
    - "All four samber libraries are installed and importable"
    - "Skills document each library's patterns with cc-relay examples"
    - "go mod tidy succeeds with new dependencies"
  artifacts:
    - path: ".claude/skills/samber-lo.md"
      provides: "samber/lo functional utilities reference"
      min_lines: 100
    - path: ".claude/skills/samber-mo.md"
      provides: "samber/mo monads reference"
      min_lines: 100
    - path: ".claude/skills/samber-do.md"
      provides: "samber/do DI reference"
      min_lines: 100
    - path: ".claude/skills/samber-ro.md"
      provides: "samber/ro reactive streams reference"
      min_lines: 80
  key_links:
    - from: ".claude/skills/samber-lo.md"
      to: "go.mod"
      via: "import path"
      pattern: "github.com/samber/lo"
---

<objective>
Install samber libraries and create comprehensive skill documentation for consistent usage patterns.

Purpose: Before refactoring, establish patterns and create reusable skills that guide consistent library adoption. Skills capture best practices from RESEARCH.md for future Claude sessions.
Output: go.mod with samber dependencies, four skill files documenting patterns with cc-relay examples.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02.3-codebase-refactor-samber-libs/02.3-RESEARCH.md
@.planning/phases/02.3-codebase-refactor-samber-libs/02.3-CONTEXT.md
@go.mod
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install samber libraries and testify</name>
  <files>
    go.mod
    go.sum
  </files>
  <action>
Install core samber libraries and supporting testing library:

```bash
# Core samber libraries
go get github.com/samber/lo@v1
go get github.com/samber/do/v2@latest
go get github.com/samber/mo@v1

# Testing library (stretchr/testify)
go get github.com/stretchr/testify

# Property-based testing
go get github.com/leanovate/gopter

# Tidy to resolve all dependencies
go mod tidy
```

NOTE: samber/ro is v0.2.0 (pre-1.0). Install it separately after core libraries are validated:
```bash
go get github.com/samber/ro@v0.2.0
go mod tidy
```

Verify imports work by creating a simple test file that imports each library.
  </action>
  <verify>
Run: `go mod tidy` - succeeds without errors
Run: `go build ./...` - builds successfully
Verify go.mod contains all four samber libraries
  </verify>
  <done>All samber libraries installed, project builds successfully</done>
</task>

<task type="auto">
  <name>Task 2: Create samber/lo and samber/mo skill documentation</name>
  <files>
    .claude/skills/samber-lo.md
    .claude/skills/samber-mo.md
  </files>
  <action>
Create skill files based on RESEARCH.md patterns, using cc-relay as example context:

**.claude/skills/samber-lo.md:**
- Quick reference for lo functions (Map, Filter, Reduce, GroupBy, Chunk, etc.)
- cc-relay examples: filtering active keys, mapping providers to names, grouping keys by provider
- When to use parallel variants (lop package) for large datasets
- Anti-patterns: chained operations creating intermediate slices
- Performance tips: FilterMap for single-pass, benchmarking guidance

**.claude/skills/samber-mo.md:**
- Result[T] and Option[T] monad patterns
- Converting (value, error) tuples to Result: mo.TupleToResult
- Chaining with FlatMap for error handling flows
- Pattern matching with Match function
- Option for nullable config fields
- cc-relay examples: auth flow chaining, config field defaults
- Anti-patterns: immediate unwrapping with MustGet

Format: Each skill should have:
1. Quick reference section (most common functions)
2. cc-relay-specific examples
3. When to use / when NOT to use
4. Common pitfalls
  </action>
  <verify>
Skill files exist at .claude/skills/samber-lo.md and .claude/skills/samber-mo.md
Each file is >100 lines with practical examples
  </verify>
  <done>lo and mo skill documentation complete with cc-relay examples</done>
</task>

<task type="auto">
  <name>Task 3: Create samber/do and samber/ro skill documentation</name>
  <files>
    .claude/skills/samber-do.md
    .claude/skills/samber-ro.md
  </files>
  <action>
Create skill files for DI and reactive streams:

**.claude/skills/samber-do.md:**
- DI container setup with do.New()
- Service registration: do.Provide, do.ProvideValue, do.ProvideTransient
- Service resolution: do.Invoke, do.MustInvoke
- Scoped containers for request-scoped services: do.NewScope
- Lifecycle management: Shutdown hooks
- cc-relay examples:
  - Singleton: Config, Cache, KeyPool, Providers
  - Request-scoped: Logger with request ID, context with timeout
- Wiring pattern for serve.go replacement
- Anti-patterns: storing request data in singletons

**.claude/skills/samber-ro.md:**
- Observable creation: ro.Just, ro.FromChannel, ro.FromSlice
- Operators: ro.Map, ro.Filter, ro.Pipe, ro.Catch
- Subscription with ro.Observer (OnNext, OnError, OnComplete)
- Note: v0.2.0 is pre-1.0 - use cautiously
- cc-relay examples:
  - SSE streaming pipeline (when implemented)
  - Rate limiting with operators (future consideration)
- When to use: actual streams (SSE, websockets, events)
- When NOT to use: simple request/response (overhead not justified)

Format: Same structure as lo/mo skills.
  </action>
  <verify>
Skill files exist at .claude/skills/samber-do.md and .claude/skills/samber-ro.md
Each file has practical patterns and cc-relay context
  </verify>
  <done>do and ro skill documentation complete</done>
</task>

</tasks>

<verification>
1. `go mod tidy` succeeds
2. `go build ./...` succeeds
3. All four skill files exist in .claude/skills/
4. go.mod contains github.com/samber/lo, github.com/samber/do/v2, github.com/samber/mo, github.com/samber/ro
5. go.mod contains github.com/stretchr/testify
</verification>

<success_criteria>
- samber/lo v1.x installed
- samber/do v2.x installed
- samber/mo v1.x installed
- samber/ro v0.2.x installed
- stretchr/testify installed
- Four skill files created with comprehensive patterns
- Project builds and all existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/02.3-codebase-refactor-samber-libs/02.3-02-SUMMARY.md`
</output>
